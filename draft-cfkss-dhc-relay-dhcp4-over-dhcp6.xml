<?xml version='1.0' ?>

<?rfc toc="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc compact="yes"?>
<?rfc subcompact="no"?>
<!DOCTYPE rfc SYSTEM "rfc2629.dtd" [
<!ENTITY rfc2119 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
<!ENTITY rfc2131 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2131.xml">
<!ENTITY rfc3315 PUBLIC "" "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3315.xml">
]>
<rfc category="std" docName="draft-cfkss-dhc-relay-dhcp4-over-dhcp6-00"
     updates="3315" ipr="trust200902">
  <front>
    <title abbrev="Relay DHCPv4 over DHCPv6">Relay DHCPv4 messages
    over DHCPv6</title>

    <author fullname="Marcin Siodelski" initials="M." surname="Siodelski">
      <organization abbrev="ISC"></organization>
      <address>
        <postal>
          <street>950 Charter Street</street>
          <city>Redwood City</city>
          <region>CA</region>
          <code>94063</code>
          <country>USA</country>
        </postal>
        <phone>+1 650 423 1431</phone>
        <email>msiodelski@gmail.com</email>
      </address>
    </author>

    <author fullname="Qi Sun" initials="Q." surname="Sun">
      <organization abbrev="(to be specified)"></organization>
      <address>
        <postal>
          <street></street>
          <city></city>
          <region></region>
          <code></code>
          <country></country>
        </postal>
        <phone></phone>
        <email></email>
      </address>
    </author>
    <date />


    <area>Internet</area>
    <workgroup>Dynamic Host Configuration Working Group</workgroup>


    <keyword>DHCPv4</keyword>
    <keyword>DHCPv6</keyword>
    <keyword>DHCPv4 over DHCPv6</keyword>

    <abstract>
      <t>This document describes the mechanism to provision the DHCPv4
      clients by leveraging DHCPv6 relays.</t>
    </abstract>
  </front>

  <middle>
    <section title="Requirements Language">
      <t>The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL
      NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED",  "MAY", and
      "OPTIONAL" in this document are to be interpreted as described in
      <xref target="RFC2119">RFC 2119</xref>.</t>
    </section>

    <section title="Introduction">
      <t>During the transition from IPv4 to IPv6 the dual stack networks
      are common. Many architectures propose delivery mechanisms based on
      IPv6-only operator's networks while still offering IPv4 connectivity.
      In many cases, the host being configured
      with DHCPv4 protocol is separated from the DHCPv4 server by the IPv6 only
      network segment. Existing protocols do not allow for DHCPv4 traffic to
      traverse IPv6 network.</t>
      <t>This document describes extensions to DHCPv6 protocol to allow
      transmission of DHCPv4 traffic via DHCPv6 enabled network.</t>
    </section>

    <section title="Terminology">
      <t>The following terminology has been used in this document:
      <list style="symbols">
        <t>Unified Server - the server which is capable to receive and process
        both DHCPv4 and DHCPv6 packets encapsulated in DHCPv6 Relay-forw
        messages. Responses to processed DHCPv4 and DHCPv6 packets are sent
        back to the Relay Agent using DHCPv6 Relay-repl messages.</t>
      </list>
      </t>
    </section>

    <section title="Assumptions">
      <t>The following requirements have been identified for the protocol
      described in this document:
      <list style="numbers">
        <t>Clients MUST not be modified.</t>
        <t>Leverage existing DHCPv6 relays infrastructure.</t>
      </list>
      </t>
    </section>

    <section title="Use Cases">
      <t>To leverage existing deployed architecture and not require additional
      components to be deployed in the network, existing DHCPv6 relays are
      extended with the new functionality.</t>

      <t>The assumption that DHCPv4 packets can be encapsulated by the DHCPv6
      RELAY-FORWARD and RELAY-REPLY messages is fundamental for the extensions
      described in this document. Thus, if the DHCPv4 client is separated from
      the DHCPv4 server by the IPv6 network segment it is required that DHCPv6
      traffic is carried through this segment and that at least one relay agent
      resides on the route between the DHCPv4 client and server.</t>

      <t>It is assumed that there is a DHCPv6 relay deployed on each
      link the clients are connected to.</t>

      <figure align="center" anchor="overview-dhcp6-server"
              title="Network topology with DHCPv6 server handling
                     DHCPv4 messages">
        <artwork><![CDATA[
+---------------+   v4
| DHCPv4 client |-------+    +-------+   Relayed  +---------------+
+---------------+       |    |Unified|  v4 and v6 |    Unified    |
                        +----| Relay |------------| DHCPv6+DHCPv4 |
+---------------+   v6  |    +-------+ Relay-forw |    Server     |
| DHCPv6 client |-------+               (DHCPv6)  +---------------+
+---------------+
]]></artwork>
      </figure>

      <t>The <xref target="overview-dhcp6-server"/> shows the sample network
      topology where the traffic from both DHCPv4 and DHCPv6 clients is directed
      to the same server. The unified relay agent conveys both v4 or v6
      messages in RELAY-FORW message described in section 7.1 of
      <xref target="RFC3315">RFC 3315</xref>, but in two different options.
      The DHCPv6 messages are conveyed in OPTION_RELAY_MSG as described in the
      <xref target="RFC3315">RFC 3315</xref> while the v4 messages are conveyed in the
      new option OPTION_RELAY_MSG4 defined in this document. This
      guarantees that relay agents and servers may easily differentiate the DHCPv4
      and DHCPv6 traffic by simply looking at the type of the option being carried
      in the RELAY-FORW message.</t>

      <t>Once the server has processed the message it sends back the response to
      the relay agent in the RELAY-REPL message described in section 7.2 of
      <xref target="RFC3315">RFC 3315</xref>. Server uses OPTION_RELAY_MSG4 to
      relay responses to DHCPv4 requests.</t>

      <t>The topology presented above requires that not only is DHCPv6 server
      capable to process DHCPv6, but also DHCPv4 traffic. Such hybrid
      implementations (referred here as "Unified Server") are common
      and in many cases can be created with a minimal effort if the particular
      code comprises shared libraries with DHCPv4 and DHCPv6 packets processing
      logic. The exact way how the server processes DHCPv4 traffic received over
      DHCPv6 is outside of scope for this document.</t>

      <t>Another desired use case is to process the v4 and v6 messages on two
      distinct servers - one server processing only v6 messages, another
      server processing only v4 messagess. The corresponding network topology
      has been shown on the <xref target="overview-dhcp4-and-dhcp6-server"/>.
      </t>

      <figure align="center" anchor="overview-dhcp4-and-dhcp6-server"
              title="Network topology with DHCPv6 server handling
                     DHCPv4 messages">
        <artwork><![CDATA[
                                             +----------------+
+---------------+  v4             +-----(4)--| Unified Server |
| DHCPv4 client |----+            |          +----------------+
+---------------+    |       +----+--+       +----------------+
                     +-(1)---| Relay |--(2)--| Unified Server |
                             +----+--+       +----------------+
+---------------+  v6             |
| DHCPv6 client |------(3)--------+
+---------------+

1. normal DHCPv4 traffic
2. DHCPv4 packets encapsulated in RELAY-FORW/RELAY-REPL message
   in DHCPv6
3. normal DHCPv6 traffic
4. DHCPv6 packets encapsulated in RELAY-FORW/RELAY-REPL message
   in DHCPv6
]]></artwork>
      </figure>

      <t>The v4 message is initiated by the DHCPv4 client and is relayed by
      the Relay in the same way as in the previous example. However, in this
      case the v6 and v4 messages are directed to different destinations.
      Therefore, the implementation which supports this use case MUST be
      capable configurable to specify different server destinations for
      each protocol family. </t>

      <t>The former of the use cases described in this chapter MUST be supported
      by all implementations conforming to this specification. The support for
      the latter use case is optional.</t>
    </section>

    <section title="Client Behavior">
      <t>The DHCPv4 client follows the <xref target="RFC2131">RFC 2131</xref>
      without any changes.</t>
    </section>

    <section title="Relay Bahavior">
      <t>TBD</t>
    </section>

    <section title="Server Behavior">
      <t>The server receives the relayed DHCPv6 traffic in DHCPv6 Relay-forward
      messages and determines the type of the traffic (DHCPv4 or DHCPv6) by
      examining whether Relay-forward message comprises the OPTION_RELAY_MSG
      or OPTION_RELAY_MSG4 option. If a single message contains both types of
      options than the server MUST drop the message.</t>

      <t>Depending whether the server has received DHCPv4 or DHCPv6 it
      creates the response and stores it in the OPTION_RELAY_MSG4 or
      OPTION_RELAY_MSG option respectivelly. This option is in turn packed
      into DHCPv6 Relay-reply message and sent back to the client.</t>
    </section>

    <section title="DHCPv4 Relay Message Option Format">
    <t>The DHCPv4 Message option carries a DHCPv4 message that is sent by the
    client or the server. Such DHCPv4 messages exclude any IP or UDP headers.</t>
    <t>The format of the Relay Message option is:</t>
    <figure align="center" anchor="dhcp4-relay-message-option-format"
            title="DHCPv4 Relay Message Option Format">
    <artwork><![CDATA[
0                   1                   2                   3
0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|       OPTION_RELAY_MSG4       |           option-len          |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|                                                               |
.                         DHCPv4-message                        .
.                                                               .
.                                                               .
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

option-code    OPTION_RELAY_MSG4 (TBD)

option-len     Length of DHCPv4-message

DHCPv4-message In a Relay-forward message, the received
               message, relayed verbatim to the next relay agent
               or server

    ]]></artwork>
    </figure>
  </section>

    <section title="Security Considerations">
      <t>TBD</t>
    </section>

    <section title="IANA Considerations">
      <t>TBD</t>
    </section>

    <section title="Acknowledgements">
      <t>TBD</t>
    </section>
  </middle>

  <back>
    <references title="Normative References">
      &rfc2119;
      &rfc2131;
      &rfc3315;
    </references>
  </back>
</rfc>
